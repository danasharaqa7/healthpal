version: '3.8'

services:
  # الخدمة الأولى: الباك اند تاعنا (جانغو)
  backend:
    # ابنيها من الـ Dockerfile اللي عملناه
    build: .
    # اربط بورت 8001 من جهازنا ببورت 8000 جوات الصندوق
    ports:
      - "8001:8000"
    # ملاحظة (v2.0): هذا السطر للتطوير فقط، عشان أي تعديل نشوفه فوراً
    volumes:
      - .:/app
    # اسحب "الأسرAR" من ملف .env
    env_file:
      - .env
    # لا تشغل الباك اند إلا لما الداتابيس تشتغل
    depends_on:
      - db
    # *** السطر الجديد والمؤقت ***
    # هذا السطر بخلي الحاوية "عايشة" عشان نقدر ندخل عليها
    command: sleep infinity

  # الخدمة الثانية: قاعدة البيانات (MySQL)
  db:
    # استخدم صورة MySQL جاهزة
    image: mysql:8.0
    # هون بنعطي الداتابيس الأسرار تاعتها (من ملف .env)
    environment:
      MYSQL_DATABASE: ${DB_NAME}
      MYSQL_USER: ${DB_USER}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
    ports:
      - "3306:3306"